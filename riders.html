<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¤ã‚±é… - é…é”å“¡ã‚’é¸ã¶</title>
    
    <!-- PWAå¯¾å¿œ -->
    <meta name="description" content="æ–™ç†ã‚‚ã€ã¨ãã‚ãã‚‚ã€ä¸€ç·’ã«å±Šã‘ã¾ã™ã€‚ã‚¤ã‚±ãƒ¡ãƒ³é…é”å“¡ã‚’æŒ‡åã§ãã‚‹æ–°æ„Ÿè¦šãƒ‡ãƒªãƒãƒªãƒ¼ã‚¢ãƒ—ãƒªã€‚">
    <meta name="theme-color" content="#ff6b9d">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="ã‚¤ã‚±é…">
    <link rel="manifest" href="./manifest.json">
    <link rel="apple-touch-icon" href="./icons/icon-192x192.png">
    
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="header">
        <div class="container">
            <div class="header-content">
                <div class="header-left">
                    <h1 class="logo">ğŸš´ ã‚¤ã‚±é… Ikehai</h1>
                    <p class="tagline">ã¨ãã‚ãé…é”ã€å±Šã‘ã¾ã™</p>
                </div>
                <div class="header-right">
                    <a href="shop.html" class="shop-link">ğŸ›ï¸ ã‚·ãƒ§ãƒƒãƒ—</a>
                </div>
            </div>
        </div>
    </header>

    <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
    <main class="main-content">
        <div class="container">
            <!-- ã‚¹ãƒ†ãƒƒãƒ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
            <div class="step-indicator">
                <div class="step completed">
                    <span class="step-number">1</span>
                    <span class="step-label">æ–™ç†é¸æŠ</span>
                </div>
                <div class="step-line"></div>
                <div class="step active">
                    <span class="step-number">2</span>
                    <span class="step-label">é…é”å“¡é¸æŠ</span>
                </div>
                <div class="step-line"></div>
                <div class="step">
                    <span class="step-number">3</span>
                    <span class="step-label">æ³¨æ–‡ç¢ºèª</span>
                </div>
            </div>

            <section class="intro-section">
                <h2>æ‹…å½“é…é”å“¡ã‚’é¸ã‚“ã§ãã ã•ã„</h2>
                <p id="selectedMenuItem">é¸æŠä¸­: èª­ã¿è¾¼ã¿ä¸­...</p>
                <p class="intro-highlight">ğŸ’• ã‚ãªãŸã®ã€Œæ¨ã—ã€ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„</p>
                <p class="rank-info-link"><a href="rank-info.html">ğŸ‘‘ ãƒ©ãƒ³ã‚¯åˆ¶åº¦ã«ã¤ã„ã¦è©³ã—ãè¦‹ã‚‹</a></p>
            </section>

            <!-- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ãƒ»ã‚½ãƒ¼ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="filter-sort-container">
                <!-- ãƒ©ãƒ³ã‚¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
                <div class="filter-section">
                    <label class="filter-label">ğŸ‘‘ ãƒ©ãƒ³ã‚¯:</label>
                    <div class="filter-buttons">
                        <button class="filter-btn active" onclick="filterByRank('all', this)">ã™ã¹ã¦</button>
                        <button class="filter-btn" onclick="filterByRank('platinum', this)">ğŸ‘‘ ãƒ—ãƒ©ãƒãƒŠ</button>
                        <button class="filter-btn" onclick="filterByRank('gold', this)">â­ ã‚´ãƒ¼ãƒ«ãƒ‰</button>
                        <button class="filter-btn" onclick="filterByRank('silver', this)">ğŸ¥ˆ ã‚·ãƒ«ãƒãƒ¼</button>
                        <button class="filter-btn" onclick="filterByRank('bronze', this)">ğŸ¥‰ ãƒ–ãƒ­ãƒ³ã‚º</button>
                    </div>
                </div>
                
                <div class="sort-section riders-sort">
                    <label class="sort-label">ğŸ“Š ä¸¦ã³æ›¿ãˆ:</label>
                    <select class="sort-select" onchange="sortRiders(this.value)">
                        <option value="default">ãŠã™ã™ã‚é †</option>
                        <option value="rank">ãƒ©ãƒ³ã‚¯ãŒé«˜ã„é †</option>
                        <option value="rating">è©•ä¾¡ãŒé«˜ã„é †</option>
                        <option value="deliveries">é…é”å›æ•°ãŒå¤šã„é †</option>
                        <option value="fee-asc">æŒ‡åæ–™ãŒå®‰ã„é †</option>
                        <option value="fee-desc">æŒ‡åæ–™ãŒé«˜ã„é †</option>
                    </select>
                </div>
                <p class="rider-count">é…é”å“¡æ•°: <span id="riderCount">12</span>å</p>
            </div>

            <!-- é…é”å“¡ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div id="ridersGrid" class="card-grid riders-grid">
                <div class="loading">èª­ã¿è¾¼ã¿ä¸­...</div>
            </div>

            <!-- æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
            <div class="back-button-container">
                <button class="btn btn-secondary" onclick="window.location.href='index.html'">
                    â† æ–™ç†ã‚’é¸ã³ç›´ã™
                </button>
            </div>
        </div>
    </main>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <footer class="footer">
        <p>&copy; 2025 Ikehai - All Rights Reserved</p>
    </footer>

    <script src="js/data.js"></script>
    <script src="js/script.js"></script>
    <script>
        let allRidersData = [];
        let currentSortType = 'default';
        let currentRankFilter = 'all';

        // ãƒ©ãƒ³ã‚¯ãƒãƒƒã‚¸ã‚’ç”Ÿæˆ
        function getRankBadge(rank, rankName) {
            const rankConfig = {
                platinum: { icon: 'ğŸ‘‘', color: '#9c27b0', gradient: 'linear-gradient(135deg, #9c27b0, #ba68c8)' },
                gold: { icon: 'â­', color: '#ffa726', gradient: 'linear-gradient(135deg, #ffa726, #ffb74d)' },
                silver: { icon: 'ğŸ¥ˆ', color: '#78909c', gradient: 'linear-gradient(135deg, #78909c, #90a4ae)' },
                bronze: { icon: 'ğŸ¥‰', color: '#a1887f', gradient: 'linear-gradient(135deg, #a1887f, #bcaaa4)' }
            };
            
            const config = rankConfig[rank] || rankConfig.bronze;
            return `<span class="rank-badge rank-${rank}" style="background: ${config.gradient}">${config.icon} ${rankName}</span>`;
        }
        
        // ãƒ©ãƒ³ã‚¯ã®æ•°å€¤å¤‰æ›ï¼ˆã‚½ãƒ¼ãƒˆç”¨ï¼‰
        function getRankOrder(rank) {
            const rankOrder = { platinum: 4, gold: 3, silver: 2, bronze: 1 };
            return rankOrder[rank] || 0;
        }

        // ãƒ©ãƒ³ã‚¯ã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
        function filterByRank(rank, clickedButton) {
            currentRankFilter = rank;
            
            // ãƒœã‚¿ãƒ³ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã‚’æ›´æ–°
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            if (clickedButton) {
                clickedButton.classList.add('active');
            }
            
            applyFilterAndSort();
        }

        // ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã¨ã‚½ãƒ¼ãƒˆã‚’é©ç”¨
        function applyFilterAndSort() {
            let filteredData = [...allRidersData];
            
            // ãƒ©ãƒ³ã‚¯ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼é©ç”¨
            if (currentRankFilter !== 'all') {
                filteredData = filteredData.filter(rider => rider.rank === currentRankFilter);
            }
            
            // ã‚½ãƒ¼ãƒˆé©ç”¨ï¼ˆsortRidersé–¢æ•°ã‚’çµ±åˆï¼‰
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            
            switch (currentSortType) {
                case 'rank':
                    filteredData.sort((a, b) => getRankOrder(b.rank) - getRankOrder(a.rank));
                    break;
                case 'rating':
                    filteredData.sort((a, b) => b.rating - a.rating);
                    break;
                case 'deliveries':
                    filteredData.sort((a, b) => b.deliveries - a.deliveries);
                    break;
                case 'fee-asc':
                    filteredData.sort((a, b) => a.nominationFee - b.nominationFee);
                    break;
                case 'fee-desc':
                    filteredData.sort((a, b) => b.nominationFee - a.nominationFee);
                    break;
                case 'default':
                default:
                    filteredData.sort((a, b) => {
                        const aIsFavorite = favorites.includes(a.id);
                        const bIsFavorite = favorites.includes(b.id);
                        if (aIsFavorite && !bIsFavorite) return -1;
                        if (!aIsFavorite && bIsFavorite) return 1;
                        if (a.isPopular && !b.isPopular) return -1;
                        if (!a.isPopular && b.isPopular) return 1;
                        return getRankOrder(b.rank) - getRankOrder(a.rank);
                    });
                    break;
            }
            
            // ã‚«ã‚¦ãƒ³ãƒˆæ›´æ–°
            document.getElementById('riderCount').textContent = filteredData.length;
            
            displayRiders(filteredData);
        }

        // é…é”å“¡ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§è¡¨ç¤º
        function loadRiders() {
            try {
                // data.jsã‹ã‚‰ç›´æ¥é…é”å“¡ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
                allRidersData = getRidersData();
                document.getElementById('riderCount').textContent = allRidersData.length;
                displayRiders(allRidersData);
            } catch (error) {
                console.error('é…é”å“¡ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                document.getElementById('ridersGrid').innerHTML = 
                    '<p class="error">é…é”å“¡ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚</p>';
            }
        }

        // é…é”å“¡ã‚’ã‚½ãƒ¼ãƒˆ
        function sortRiders(sortType) {
            currentSortType = sortType;
            applyFilterAndSort();
        }

        // é…é”å“¡ã‚’ç”»é¢ã«è¡¨ç¤º
        function displayRiders(riders) {
            const ridersGrid = document.getElementById('ridersGrid');
            ridersGrid.innerHTML = '';

            // ãŠæ°—ã«å…¥ã‚Šã‚’å–å¾—
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            
            // ãŠæ°—ã«å…¥ã‚Šã®é…é”å“¡ã‚’å…ˆé ­ã«ä¸¦ã¹ã‚‹
            const sortedRiders = [...riders].sort((a, b) => {
                const aIsFavorite = favorites.includes(a.id);
                const bIsFavorite = favorites.includes(b.id);
                if (aIsFavorite && !bIsFavorite) return -1;
                if (!aIsFavorite && bIsFavorite) return 1;
                return 0;
            });

            sortedRiders.forEach(rider => {
                const isFavorite = favorites.includes(rider.id);
                const card = document.createElement('div');
                card.className = 'card rider-card';
                
                // äººæ°—ãƒãƒƒã‚¸ã®è¡¨ç¤º
                const popularBadge = rider.isPopular ? 
                    '<span class="popular-badge">ğŸ”¥ äººæ°—</span>' : '';
                
                // ãŠæ°—ã«å…¥ã‚Šãƒãƒƒã‚¸ã®è¡¨ç¤º
                const favoriteBadge = isFavorite ? 
                    '<span class="favorite-badge-rider">â¤ï¸ ãŠæ°—ã«å…¥ã‚Š</span>' : '';
                
                // ãƒ©ãƒ³ã‚¯ãƒãƒƒã‚¸ã®è¡¨ç¤º
                const rankBadge = getRankBadge(rider.rank, rider.rankName);
                
                // ãƒ©ãƒ³ã‚¯ç‰¹å…¸ã®ç”Ÿæˆ
                const benefitsTags = rider.rankBenefits.map(benefit => 
                    `<span class="benefit-tag">âœ“ ${benefit}</span>`
                ).join('');
                
                // è¶£å‘³ã‚¿ã‚°ã®ç”Ÿæˆ
                const hobbiesTags = rider.hobbies.map(hobby => 
                    `<span class="hobby-tag">${hobby}</span>`
                ).join('');
                
                // ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºï¼ˆæœ€åˆã®2ä»¶ã®ã¿ï¼‰
                const reviewsHTML = rider.reviews.slice(0, 2).map(review => `
                    <div class="review-item">
                        <div class="review-header">
                            <span class="review-user">${review.user}</span>
                            <span class="review-rating">${'â­'.repeat(review.rating)}</span>
                        </div>
                        <p class="review-comment">${review.comment}</p>
                    </div>
                `).join('');
                
// ã‚¹ãƒãƒ³ã‚µãƒ¼æƒ…å ±
                const sponsorInfo = getSponsorInfo(rider.id);
                const sponsorHTML = sponsorInfo ? `
                    <div class="sponsor-info">
                        <h4 class="sponsor-title">ğŸ¤ ãƒ–ãƒ©ãƒ³ãƒ‰ã‚¢ãƒ³ãƒã‚µãƒ€ãƒ¼</h4>
                        <div class="sponsor-card">
                            <img src="${sponsorInfo.brandImage}" alt="${sponsorInfo.brandName}" class="sponsor-image">
                            <div class="sponsor-text">
                                <p class="sponsor-brand">${sponsorInfo.brandName}</p>
                                <p class="sponsor-message">${sponsorInfo.brandMessage}</p>
                            </div>
                        </div>
                    </div>
                ` : '';
                
                // é–¢é€£ã‚°ãƒƒã‚ºæƒ…å ±
                const relatedProducts = getProductsByRider(rider.id);
                const productsHTML = relatedProducts.length > 0 ? `
                    <div class="related-products">
                        <h4 class="related-products-title">ğŸ›ï¸ ${rider.name}ã•ã‚“é–¢é€£ã‚°ãƒƒã‚º</h4>
                        <div class="related-products-list">
                            ${relatedProducts.slice(0, 2).map(product => `
                                <div class="related-product-item" onclick="window.location.href='shop.html'">
                                    <img src="${product.image}" alt="${product.name}" class="related-product-image">
                                    <p class="related-product-name">${product.name}</p>
                                    <p class="related-product-price">Â¥${product.price.toLocaleString()}</p>
                                </div>
                            `).join('')}
                        </div>
                        <a href="shop.html" class="related-products-link">ã‚‚ã£ã¨è¦‹ã‚‹ â†’</a>
                    </div>
                ` : '';
                
                card.innerHTML = `
                    <div class="rider-image">
                        <img src="${rider.image}" alt="${rider.name}">
                        <span class="rider-type-badge">${rider.type}</span>
                        ${popularBadge}
                        ${favoriteBadge}
                    </div>
                    <div class="card-content">
                        <div class="rider-header">
                            <h3 class="card-title">${rider.name}</h3>
                            ${rankBadge}
                        </div>
                        <p class="nomination-fee-large">æŒ‡åæ–™ Â¥${rider.nominationFee.toLocaleString()}</p>
                        <p class="rider-stats">
                            â­ ${rider.rating} | ğŸš´ ${rider.deliveries}å›é…é”
                        </p>
                        <p class="rider-quote">"${rider.quote}"</p>
                        
                        <!-- ãƒ‘ãƒ¼ã‚½ãƒŠãƒªãƒ†ã‚£ -->
                        <div class="rider-personality">
                            <p><strong>âœ¨ ${rider.personality}</strong></p>
                        </div>
                        
                        <!-- ãƒ©ãƒ³ã‚¯ç‰¹å…¸ -->
                        <div class="rank-benefits-container">
                            <h4 class="benefits-title">ğŸ ${rider.rankName}ãƒ©ãƒ³ã‚¯ç‰¹å…¸</h4>
                            <div class="benefits-tags">
                                ${benefitsTags}
                            </div>
                        </div>
                        
                        <!-- ãŠã™ã™ã‚ã‚¿ã‚¤ãƒ— -->
                        <div class="rider-recommend">
                            <p>ğŸ’• <strong>ã“ã‚“ãªæ–¹ã«ãŠã™ã™ã‚ï¼š</strong>${rider.recommendFor}</p>
                        </div>
                        
                        <!-- è¶£å‘³ã‚¿ã‚° -->
                        <div class="hobbies-container">
                            ${hobbiesTags}
                        </div>
                        
                        <!-- ãƒ¬ãƒ“ãƒ¥ãƒ¼ -->
                        <div class="reviews-container">
                            <h4 class="reviews-title">ğŸ’¬ ãŠå®¢æ§˜ã®å£°</h4>
                            ${reviewsHTML}
                        </div>
                        
<!-- ã‚¹ãƒãƒ³ã‚µãƒ¼æƒ…å ± -->
                        ${sponsorHTML}
                        
                        <!-- é–¢é€£ã‚°ãƒƒã‚º -->
                        ${productsHTML}
                        
                        <button class="btn btn-primary" onclick="selectRider(${rider.id}, '${rider.name}')">
                            ${rider.name}ã•ã‚“ã‚’æŒ‡åã™ã‚‹ â¤ï¸
                        </button>
                    </div>
                `;
                ridersGrid.appendChild(card);
            });
        }

        // é…é”å“¡é¸æŠæ™‚ã®å‡¦ç†
        function selectRider(riderId, riderName) {
            // é¸æŠæƒ…å ±ã‚’localStorageã«ä¿å­˜
            localStorage.setItem('selectedRiderId', riderId);
            localStorage.setItem('selectedRiderName', riderName);
            // ç¢ºèªãƒšãƒ¼ã‚¸ã¸é·ç§»
            window.location.href = 'confirm.html';
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®å‡¦ç†
        window.addEventListener('DOMContentLoaded', () => {
            // é¸æŠã•ã‚ŒãŸãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¡¨ç¤º
            const menuName = localStorage.getItem('selectedMenuName');
            if (menuName) {
                document.getElementById('selectedMenuItem').textContent = 
                    `é¸æŠä¸­: ${menuName}`;
            } else {
                // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒé¸æŠã•ã‚Œã¦ã„ãªã„å ´åˆã¯ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¸
                window.location.href = 'index.html';
            }

            // é…é”å“¡ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
            loadRiders();
        });
    </script>
</body>
</html>

